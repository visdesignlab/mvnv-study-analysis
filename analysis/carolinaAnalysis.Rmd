---
title: "carolinaAnalysis"
author: '@carolinanobre'
date: "9/3/2019"
output: html_document
---

## Setup

```{r setup}
library(tidyverse)
library(ggridges)
library(pwr) 
library(grid)
library(gtable)

library(ggbeeswarm)

library(tidybayes)
library(cowplot)
library(broom)
library(Hmisc)

theme_set(theme_tidybayes() + panel_border() + background_grid())


#df <- read.csv("../results/pilot/CSV/TidyR.csv")
df <- read.csv("../results/study/CSV/TidyR.csv")
dfp <- read.csv("../results/study/CSV/participantInfoTidyR.csv")
```


## Data Cleaning / Types

```{r}

df_acc <- df %>% 
  filter(measure=="accuracy") 

df_acc$value = as.numeric( as.character(df_acc$value ))


df_acc
```

```{r}
df %>% 
  filter(measure=="accuracy") %>% 
  mutate( value = as.numeric( as.character(value)) ) %>% 
  ggplot( aes(x=value, y=taskId) ) +
    geom_density_ridges() +
    facet_grid(. ~ visType)

```

```{r}

df_acc <- df %>% 
  filter(measure=="accuracy") 

df_acc$value = as.numeric( as.character(df_acc$value ))


df_time<- df %>% 
  filter(measure=="minutesOnTask") 

df_time$value = as.numeric( as.character(df_time$value ))


newFrame <- merge(df_time,df_acc, by="prolificId")

#newFrame

ggplot(newFrame, aes(x = value.x, y = value.y)) +
    geom_point(aes(color=visType.y))+
    facet_grid (visType.y ~taskId.y) +
    xlab("Time") +
    ylab("Accuracy")

ggsave(paste("charts/time_vs_accuracy_horizontal.pdf", sep=""), width = 35, height =3, units = "in")

```


```{r}
filteredFrame<- filter(dfp,measure=="visExperience")
accuracy <- mutate(filteredFrame, ageValue = as.numeric( as.character(value)) ) 

filteredFrame<- filter(dfp,measure=="averageAccuracy")
acc <- mutate( filteredFrame, avgAcc = round(as.numeric(as.character(value)),digits=2) ) 

filteredFrame<- filter(dfp,measure=="minutesOnTask")
time <- mutate( filteredFrame, timeValue = round(as.numeric(as.character(value)),digits=2) ) 

visType <- unique(select(df,"prolificId","visType"))


newFrame <- merge(time,acc, by="prolificId")

newFrame <- merge(newFrame,visType, by="prolificId")


ggplot(newFrame, aes(x = timeValue, y = avgAcc)) +
    geom_point(aes(color=visType))+
    facet_grid(visType ~ .) +
    xlab("Time") +
    ylab("Average Accuracy")
```


```{r}

dfp %>% 
  filter(measure == "age") %>% 
  mutate( value = as.numeric( as.character(value)) ) %>% 
  ggplot(aes(x="age", y=value)) +
    geom_beeswarm(priority='density',cex=2, alpha=.6) +
  coord_flip() +
  xlab("") + ylab("")


histogramFunc <- function(var) {
data<- filter(dfp,measure == var) 
  ggplot(data=data, aes(data$value)) + 
    geom_histogram(stat="count") +
    xlab(var) 

    ggsave(paste("charts/",var,".pdf", sep=""), width = 7, height = 2, units = "in")
}

histogramFunc("age");
histogramFunc("browser");
histogramFunc("sex");
histogramFunc("degree");
histogramFunc("visExperience");


```


```{r, fig.width=8, fig.height=2}


vplot <- function(task) {

sdf = df %>% filter( taskId == task )
tt = as.character(sdf[1,]$taskTitle)

df %>% 
  filter( measure == "accuracy" | measure == "minutesToComplete" | 
            measure == "difficulty" | measure == "confidence") %>% 
    filter( taskId == task ) %>% 
  mutate( value = as.numeric( as.character(value)) ) %>% 
  ggplot(aes(x=visType, y=value, fill=visType, color=visType)) +
    facet_wrap(. ~ measure, scales="free", nrow=1) +
    geom_violin() +
    stat_summary(fun.data = "mean_cl_boot", colour = "black", size = 0.5, alpha=1) +
  coord_flip() + 
    labs(
      title = tt,
      subtitle = task
    )
  
ggsave(paste("violins/",task,".pdf", sep=""), width = 10, height = 2.5, units = "in")
}


vplot("S-task01")
vplot("S-task02")
vplot("S-task03")
vplot("S-task04")
vplot("S-task05")
vplot("S-task06")
vplot("S-task07")
vplot("S-task08")
vplot("S-task09")
vplot("S-task10")
vplot("S-task11")
vplot("S-task12")
vplot('S-task12A')
vplot('S-task12B')
vplot("S-task13")
vplot("S-task14")
vplot("S-task15")
vplot("S-task16")

  
```