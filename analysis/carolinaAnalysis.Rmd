---
title: "carolinaAnalysis"
author: '@carolinanobre'
date: "9/3/2019"
output: html_document
fig_width: 12 
fig_height: 4 
---

## Setup

```{r setup}
library(tidyverse)
library(ggridges)
library(pwr) 
library(grid)
library(gtable)

library(ggthemes)

library(ggbeeswarm)

library(tidybayes)
library(cowplot)
library(broom)
library(Hmisc)

theme_set(theme_tidybayes() + panel_border() + background_grid())


#df <- read.csv("../results/pilot/CSV/TidyR.csv")
df <- read.csv("../results/study/CSV/TidyR.csv")
dfp <- read.csv("../results/study/CSV/participantInfoTidyR.csv")

dfc <- read.csv("../results/study/MaxQDA/codesTidy.csv")
```



```{r}

data <- 
  dfc %>%
  group_by(Code) %>%
  count()

data <-mutate(data,type=ifelse(grepl("topology-attribute", Code), "topology-attribute",
                               ifelse(grepl("topology", Code), "topology",
                                      ifelse(grepl("attribute", Code), "attribute", "Other")))) 


#data$n

data$Code <- factor(data$Code, levels = data$Code[order(-data$n)])

ggplot(data=data, aes(x=Code, y=n, fill=type)) +
  geom_bar(stat="identity")+
    #theme_tufte()+
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  ylab("Code Frequency")
  



histogramFunc <- function() {
#data<- filter(dfp,measure == var) 
  
  #dfc$Code <- factor(dfc$Code,levels='a','b','c')

  ggplot(data=data, aes(data$n)) + 
    geom_histogram() +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
    xlab("Code") 

}

#histogramFunc()
    

```


## Data Cleaning / Types

```{r}

df_acc <- df %>% 
  filter(measure=="accuracy") 

df_acc$value = as.numeric( as.character(df_acc$value ))


df_acc
```

```{r}
df %>% 
  filter(measure=="accuracy") %>% 
  mutate( value = as.numeric( as.character(value)) ) %>% 
  ggplot( aes(x=value, y=taskId) ) +
    geom_density_ridges() +
    facet_grid(. ~ visType)

```

```{r}

df_acc <- df %>% 
  filter(measure=="accuracy") 

df_acc$value = as.numeric( as.character(df_acc$value ))


df_time<- df %>% 
  filter(measure=="minutesOnTask") 

df_time$value = as.numeric( as.character(df_time$value ))


newFrame <- merge(df_time,df_acc, by="prolificId")

#newFrame

ggplot(newFrame, aes(x = value.x, y = value.y)) +
    geom_point(aes(color=visType.y))+
    facet_grid (visType.y ~taskId.y) +
    xlab("Time") +
    ylab("Accuracy")

ggsave(paste("charts/time_vs_accuracy_horizontal.pdf", sep=""), width = 35, height =3, units = "in")

```


```{r}

experience <- mutate(filter(dfp,measure=="visExperience"), visExperience = ifelse(as.numeric( as.character(value)) <3, "low (1-2)",
                                     ifelse(as.numeric( as.character(value))<6, "medium (3-5)", "high (6-7)"))) 
acc <- mutate( filter(dfp,measure=="averageAccuracy"), avgAcc = round(as.numeric(as.character(value)),digits=2) ) 

time <- mutate( filter(dfp,measure=="minutesOnTask"), timeValue = round(as.numeric(as.character(value)),digits=2) ) 

vis_type <- unique(select(df,"prolificId","visType"))


newFrame <- merge(experience,acc, by="prolificId")

newFrame <- merge(newFrame,vis_type, by="prolificId")

newFrame <- merge(newFrame,time, by="prolificId")


newFrame$visExperience <- factor(newFrame$visExperience, levels= c("low (1-2)","medium (3-5)","high (6-7)"))




#ggplot(newFrame, aes(x = timeValue, y = avgAcc)) +
#    geom_point(aes(color=visType))+
#    facet_grid(visType ~ .) +
#    xlab("Time") +
#    ylab("Average Accuracy")


ggplot(newFrame, aes(x = visType, y = avgAcc)) +
      #geom_beeswarm(priority='random', cex=4,alpha=0.3,size=3,aes(color=visType)) +
    geom_point(aes(color=visType,alpha=0.5,size=3))+

    facet_grid(. ~ visExperience) +
  stat_summary(fun.data = "mean_cl_boot", colour = "black", size = 0.5, alpha=1) +
    xlab("vis experience") +
    ylab("mean accuracy")


ggplot(newFrame, aes(x = visType, y = timeValue)) +
      #geom_beeswarm(priority='random',cex=4,alpha=0.3,size=3,aes(color=visType)) +

    geom_point(aes(color=visType,alpha=0.5,size=3))+
    facet_grid(. ~ visExperience) +
  stat_summary(fun.data = "mean_cl_boot", colour = "black", size = 0.5, alpha=1) +
    xlab("vis experience") +
    ylab("time")

```


```{r}

dfp %>% 
  filter(measure == "age") %>% 
  mutate( value = as.numeric( as.character(value)) ) %>% 
  ggplot(aes(x="age", y=value)) +
    geom_beeswarm(priority='density',cex=2, alpha=.6) +
  coord_flip() +
  xlab("") + ylab("")


histogramFunc <- function(var) {
data<- filter(dfp,measure == var) 
  ggplot(data=data, aes(data$value)) + 
    geom_histogram(stat="count") +
    xlab(var) 

    ggsave(paste("charts/",var,".pdf", sep=""), width = 7, height = 2, units = "in")
}

histogramFunc("age");
histogramFunc("browser");
histogramFunc("sex");
histogramFunc("degree");
histogramFunc("visExperience");


```


```{r, fig.width=8, fig.height=2}


vplot <- function(task) {

sdf = df %>% filter( taskId == task )
tt = as.character(sdf[1,]$taskTitle)

df %>% 
  filter( measure == "accuracy" | measure == "minutesToComplete" | 
            measure == "difficulty" | measure == "confidence") %>% 
    filter( taskId == task ) %>% 
  mutate( value = as.numeric( as.character(value)) ) %>% 
  ggplot(aes(x=visType, y=value, fill=visType, color=visType)) +
    facet_wrap(. ~ measure, scales="free", nrow=1) +
    geom_violin() +
    stat_summary(fun.data = "mean_cl_boot", colour = "black", size = 0.5, alpha=1) +
  coord_flip() + 
    labs(
      title = tt,
      subtitle = task
    )
  
ggsave(paste("violins/",task,".pdf", sep=""), width = 10, height = 2.5, units = "in")
}


vplot("S-task01")
vplot("S-task02")
vplot("S-task03")
vplot("S-task04")
vplot("S-task05")
vplot("S-task06")
vplot("S-task07")
vplot("S-task08")
vplot("S-task09")
vplot("S-task10")
vplot("S-task11")
vplot("S-task12")
vplot('S-task12A')
vplot('S-task12B')
vplot("S-task13")
vplot("S-task14")
vplot("S-task15")
vplot("S-task16")

  
```